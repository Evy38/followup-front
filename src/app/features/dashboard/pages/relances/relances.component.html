<!-- relances.component.html -->
<div class="relances-container">
  <!-- Header avec stats -->
  <div class="relances-header">
    <h1>Mes relances</h1>
    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-number">{{ candidatures.length }}</span>
        <span class="stat-label">Candidatures</span>
      </div>
      <div class="stat-item urgent">
        <span class="stat-number">{{ getPendingCount() }}</span>
        <span class="stat-label">À relancer</span>
      </div>
    </div>
  </div>

  <!-- Filtres rapides -->
  <div class="quick-filters">
    <button 
      [class.active]="filterStatus === 'relances'"
      (click)="filterStatus = 'relances'">
      Mes relances
    </button>
    <button 
      [class.active]="filterStatus === 'reponses'"
      (click)="filterStatus = 'reponses'">
      Réponses employeurs
    </button>
  </div>

  <!-- Liste des candidatures -->
  <div class="candidatures-list">
    <div *ngFor="let c of filteredCandidatures" class="candidature-timeline-card">
      
      <!-- Cercle de progression -->
      <div class="progress-circle">
        <svg viewBox="0 0 36 36">
          <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="circle-progress" 
            [attr.stroke-dasharray]="getProgress(c) + ', 100'"
            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
        <span class="progress-text">{{ getProgress(c) | number:'1.0-0' }}%</span>
      </div>
      
      <!-- Informations de la candidature -->
      <div class="card-header">
        <div class="card-info">
          <h3 class="job-title">{{ c.jobTitle }}</h3>
          <p class="company-name">{{ c.entreprise.nom || 'Entreprise inconnue' }}</p>
          <p class="candidature-meta">
            Candidature envoyée il y a {{ getDaysSince(c.dateCandidature) }} jours
            <span class="date-badge">{{ c.dateCandidature | date:'dd/MM/yyyy' }}</span>
          </p>
        </div>
      </div>

      <!-- Affichage conditionnel selon l'onglet -->
      <ng-container *ngIf="filterStatus === 'relances'; else etatCandidatureBlock">
        <!-- Timeline des relances - Version compacte horizontale -->
        <div class="relances-timeline">
          <ng-container *ngFor="let rang of [1, 2, 3]">
            <ng-container *ngIf="getRelanceByRang(c, rang) as r">
              <div class="timeline-item" 
                [class.done]="r.faite"
                [class.overdue]="isRelanceOverdue(r) && !r.faite"
                [class.upcoming]="!r.faite && !isRelanceOverdue(r)"
                [class.clickable]="!r.faite"
                (click)="!r.faite ? markAsDone(c, r) : null">
                <div class="timeline-point" 
                  [class.done]="r.faite"
                  [class.overdue]="isRelanceOverdue(r) && !r.faite"
                  [class.upcoming]="!r.faite && !isRelanceOverdue(r)">
                </div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <span class="relance-number">Relance {{ rang }}</span>
                    <span class="relance-timing">+{{ rang }} semaine{{ rang > 1 ? 's' : '' }}</span>
                  </div>
                  <div class="relance-date">
                    {{ r.dateRelance | date:'dd/MM' }}
                    <span *ngIf="isRelanceOverdue(r) && !r.faite" class="overdue-badge">
                      !
                    </span>
                  </div>
                  <div class="relance-actions">
                    <button *ngIf="!r.faite" 
                      class="btn-mark-done"
                      [class.btn-urgent]="isRelanceOverdue(r)"
                      (click)="$event.stopPropagation(); markAsDone(c, r)"
                      title="Marquer comme faite">
                      ✓ Marquer comme faite
                    </button>
                    <div *ngIf="r.faite" class="status-done">
                      <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                        <circle cx="8" cy="8" r="7" fill="#22c55e"/>
                        <path d="M5 8L7 10L11 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      <button (click)="$event.stopPropagation(); markAsUndone(c, r)" class="btn-mark-done btn-urgent" title="Annuler">
                        ✕
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </ng-container>
      <ng-template #etatCandidatureBlock>
        <div class="etat-candidature">
          <strong>État :</strong> {{ getEtatCandidature(c) }}
        </div>
      </ng-template>
    </div>

    <!-- Message si vide -->
    <div *ngIf="filteredCandidatures.length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
        <circle cx="32" cy="32" r="30" stroke="#e5e7eb" stroke-width="4"/>
        <path d="M32 20v16m0 4h.01" stroke="#9ca3af" stroke-width="4" stroke-linecap="round"/>
      </svg>
      <p>Aucune candidature à afficher</p>
    </div>
  </div>
</div>