<!-- Bouton burger/croix visible en permanence sur mobile -->
<button class="burger-btn" (click)="sidebarOpen ? closeSidebar() : toggleSidebar()" aria-label="Menu"
  [class.open]="sidebarOpen">
  <span *ngIf="!sidebarOpen"></span>
  <span *ngIf="!sidebarOpen"></span>
  <span *ngIf="!sidebarOpen"></span>
  <svg *ngIf="sidebarOpen" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
    <line x1="4" y1="4" x2="18" y2="18" stroke="#a259ff" stroke-width="2.2" stroke-linecap="round" />
    <line x1="18" y1="4" x2="4" y2="18" stroke="#a259ff" stroke-width="2.2" stroke-linecap="round" />
  </svg>
</button>

<!-- Sidebar overlay sur mobile -->
<aside class="sidebar" aria-label="Navigation priv√©e" [class.open]="sidebarOpen" (click)="closeSidebar()">
  <div class="sidebar-content" (click)="($event.stopPropagation())">

    <!-- ============================================================
         PROFIL UTILISATEUR
         ============================================================ -->
    <div class="sidebar-profile">
      <div class="avatar-wrapper">
        <img src="/assets/icons/avatar.png" alt="Avatar" class="avatar-img" />
      </div>
      <div class="profile-info user-menu-trigger">
        <ng-container *ngIf="auth.user$ | async as user">
          <div class="user-row">
            <div class="user-texts">
              <div class="profile-name">{{ user.lastName || 'NOM' }}</div>
              <div class="profile-firstname">{{ user.firstName || 'Pr√©nom' }}</div>
              <div class="profile-email">{{ user.email || 'nom.email@gmail.com' }}</div>
            </div>
            <button class="user-menu-arrow" (click)="toggleUserMenu()" aria-label="Ouvrir le menu utilisateur">
              <svg [class.open]="userMenuOpen" width="22" height="22" viewBox="0 0 22 22" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M8 5L14 11L8 17" stroke="#222" stroke-width="2.2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </button>
          </div>
          <!-- Overlay pour mobile uniquement -->
          <div class="user-menu-overlay" *ngIf="userMenuOpen" (click)="closeUserMenu()"></div>
          
          <!-- Menu utilisateur modal -->
          <div class="user-menu user-menu-modal" *ngIf="userMenuOpen">
            <!-- Bouton de fermeture -->
            <button class="user-menu-close" (click)="closeUserMenu()" aria-label="Fermer">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="6" y1="6" x2="18" y2="18" stroke="#666" stroke-width="2.5" stroke-linecap="round" />
                <line x1="18" y1="6" x2="6" y2="18" stroke="#666" stroke-width="2.5" stroke-linecap="round" />
              </svg>
            </button>

            <!-- Avatar et infos utilisateur -->
            <div class="user-menu-header">
              <div class="user-menu-avatar-wrapper">
                <img src="/assets/icons/avatar.png" alt="Avatar" class="user-menu-avatar" />
              </div>
              <ng-container *ngIf="auth.user$ | async as user">
                <div class="user-menu-name">{{ user.lastName || 'NOM' }}</div>
                <div class="user-menu-firstname">{{ user.firstName || 'Pr√©nom' }}</div>
                <div class="user-menu-email">{{ user.email || 'email@example.com' }}</div>
              </ng-container>
            </div>

            <!-- S√©parateur -->
            <div class="user-menu-separator"></div>

            <!-- Options du menu -->
            <div class="user-menu-options">
              <a routerLink="/app/profile" class="user-menu-item" (click)="closeUserMenu()">
                <span class="user-menu-icon">üë§</span> Mon profil
              </a>
              <div class="user-menu-item" (click)="closeUserMenu()">
                <span class="user-menu-icon">‚öôÔ∏è</span> Param√®tres
              </div>
              <div class="user-menu-item user-menu-logout" (click)="logout()">
                <span class="user-menu-icon">üö™</span> D√©connexion
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="!(auth.user$ | async)">
          <div class="user-row">
            <div class="user-texts">
              <div class="profile-name">NOM</div>
              <div class="profile-firstname">Pr√©nom</div>
              <div class="profile-email">nom.email@gmail.com</div>
            </div>
            <button class="user-menu-arrow" disabled>
              <span>&#9654;</span>
            </button>
          </div>
        </ng-container>
      </div>
      <div class="profile-separator"></div>
    </div>

    <!-- ============================================================
         NAVIGATION : MENU UTILISATEUR (visible si ROLE_USER uniquement)
         ============================================================ -->
    <nav class="sidebar-nav" *ngIf="!isAdmin">
      <a routerLink="/app/dashboard" routerLinkActive="active" class="sidebar-item">
        <img src="/assets/icons/home.png" class="sidebar-icon" alt="Dashboard" />
        <span>Dashboard</span>
      </a>
      <a routerLink="/app/candidatures" routerLinkActive="active" class="sidebar-item">
        <img src="/assets/icons/Profil.png" class="sidebar-icon" alt="Candidatures" />
        <span>Candidatures</span>
      </a>
      <a routerLink="/app/annonces" routerLinkActive="active" class="sidebar-item">
        <img src="/assets/icons/annonces.png" class="sidebar-icon" alt="Annonces" />
        <span>Annonces</span>
      </a>
      <a routerLink="/app/relances" routerLinkActive="active" class="sidebar-item">
        <img src="/assets/icons/relances.png" class="sidebar-icon" alt="Relances" />
        <span>Relances</span>
      </a>
    </nav>

    <!-- ============================================================
         NAVIGATION : MENU ADMIN (visible si ROLE_ADMIN uniquement)
         ============================================================ -->
    <nav class="sidebar-nav" *ngIf="isAdmin">
      <a routerLink="/app/admin/users" routerLinkActive="active" class="sidebar-item sidebar-item--admin">
        <span class="admin-icon">‚öôÔ∏è</span>
        <span>Gestion des utilisateurs</span>
      </a>
    </nav>

  </div>
</aside>